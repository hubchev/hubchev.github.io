<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Dr.&nbsp;Stephan Huber">
<meta name="dcterms.date" content="2024-03-08">

<title>Economic Thinking in a Global Context (M-IM 1)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="etgc-syllabus_files/libs/clipboard/clipboard.min.js"></script>
<script src="etgc-syllabus_files/libs/quarto-html/quarto.js"></script>
<script src="etgc-syllabus_files/libs/quarto-html/popper.min.js"></script>
<script src="etgc-syllabus_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="etgc-syllabus_files/libs/quarto-html/anchor.min.js"></script>
<link href="etgc-syllabus_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="etgc-syllabus_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="etgc-syllabus_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="etgc-syllabus_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="etgc-syllabus_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="etgc-syllabus.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Economic Thinking in a Global Context (M-IM 1)</h1>
<p class="subtitle lead">Syllabus</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Dr.&nbsp;Stephan Huber </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 8, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="learning-outcomes" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="learning-outcomes">Learning Outcomes</h2>
<p>After successful completion of the module, students are able to:</p>
<ul>
<li>describe the basics of economic reasoning and the concept of scarcity,</li>
<li>discuss the use of the assumption of rationally acting individuals in economic theory,</li>
<li>apply appropriate terminology, concepts, measures, and theories in economic contexts,</li>
<li>analyse the outcomes of consumer and producer decisions in an economy,</li>
<li>predict the consequences of exogenous shocks, and government actions at the aggregate</li>
<li>level by applying basic economic concepts and theories,</li>
<li>describe the welfare implications of international trade,</li>
<li>identify the nature and causes of contemporary economic problems and issues for</li>
<li>individuals, firms and governments, and discuss appropriate policies to solve them,</li>
<li>apply mathematical models to international financial products.</li>
</ul>
</section>
<section id="lecturer" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="lecturer">Lecturer</h2>
<p>Prof.&nbsp;Dr.&nbsp;Stephan Huber</p>
<ul>
<li><em>Email:</em> Stephan.Huber@hs-fresenius.de</li>
<li><em>Office:</em> Building 4e OG3 (open space)</li>
<li><em>Office hours:</em> upon request, please use the <a href="https://outlook.office.com/bookwithme/user/14d08ecdf3564ba3ac8a4964df551648%40hs-fresenius.de/meetingtype/eWn2NIs9nUqQZbLtLr38CA2?anonymous">booking tool</a> to schedule an meeting.</li>
</ul>
</section>
<section id="lecture-time-and-place" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="lecture-time-and-place">Lecture Time and Place</h2>
<p>Wednesday 7:30-9:00, building 4c room EG2/SR1</p>
</section>
<section id="module-content" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="module-content">Module Content</h2>
<section id="the-scope-and-method-of-economics" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="the-scope-and-method-of-economics">The Scope and Method of Economics</h3>
<ul>
<li>The Five Big Economics Questions: What? How? When? Where? Who?</li>
<li>Eight Big Ideas of Economics (Every Choice is a Trade-off, Choice at the Margin, Voluntary Exchange, Market Failure and Government Action, Expenditure Equals Income, Living Standards and Productivity, Rising Prices, Unemployment)</li>
<li>Sub-Disciplines of Economics</li>
<li>How Economic Theories Are Developed and Empirically Tested</li>
</ul>
</section>
<section id="production-consumption-growth-and-trade" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="production-consumption-growth-and-trade">Production, Consumption, Growth, and Trade</h3>
<ul>
<li>How to Measure Welfare</li>
<li>Production Possibility Frontier and Growth</li>
<li>Indifference Curves and Optimal Consumption</li>
<li>Gains from Trade: Comparative and Absolute Advantage</li>
</ul>
</section>
<section id="markets" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="markets">Markets</h3>
<ul>
<li>Elements of a Market (Supply, Demand, Price)</li>
<li>Market Equilibrium</li>
<li>The Optimal Allocation of Resources in Markets</li>
<li>The Two Fundamental Theorems of Welfare Economics</li>
<li>Perfect Competition and Sources of Market Failure</li>
</ul>
</section>
<section id="behavioral-economics" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="behavioral-economics">Behavioral Economics</h3>
<ul>
<li>Characteristics of Decisions</li>
<li>System 1 and System 2 Thinking</li>
<li>Common Biases of Decision Making</li>
<li>Rational Models of Decision Making</li>
<li>Automated Decision Making</li>
</ul>
</section>
<section id="financial-mathematics" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="financial-mathematics">Financial Mathematics</h3>
<ul>
<li>The Theory of Interest</li>
<li>Exchange Rates and International Investments</li>
</ul>
</section>
<section id="contemporary-economic-problems" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="contemporary-economic-problems">Contemporary Economic Problems</h3>
<ul>
<li>Inflation</li>
<li>Business Cycles</li>
<li>Trade Wars</li>
<li>Global Warming</li>
</ul>
</section>
</section>
<section id="workload" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="workload">Workload</h2>
<p>125h Overall</p>
<p>28h physical synchonous contact hours</p>
<p>35h guided private study hours</p>
<p>62h private study hours</p>
</section>
<section id="learning-material" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="learning-material">Learning Material:</h2>
<p>Can be found on <a href="https://ilias.hs-fresenius.de/goto_HSF_crs_3028819.html">ILIAS</a></p>
</section>
<section id="assessment-methods-and-criteria" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="assessment-methods-and-criteria">Assessment Methods and Criteria</h2>
<p>Students complete this module – which is worth 5/120 ECTS points – with a written exam of 90 minutes. A passing grade in this module is achieved when the overall grade is greater than or equal to 4.0. Past exams can be found <a href="https://github.com/hubchev/courses/tree/main/exams">here</a>.</p>
</section>
<section id="weekly-learning-plan" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="weekly-learning-plan">Weekly Learning Plan</h2>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 62%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">CPMK</th>
<th style="text-align: left;">Content</th>
<th style="text-align: left;">Readings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Introduction</td>
<td style="text-align: left;">We introduce the scope of economics, encompassing microeconomics and macroeconomics. We discuss fundamental economic principles and delve into concepts such as scarcity, choices, and opportunity costs. Additionally, we introduce the dynamics of demand, supply, and market equilibrium. The economic way of thinking and scientific methods are discussed and we cover essential mathematical fundamentals for effective economic analysis.</td>
<td style="text-align: left;">Lecture notes; <span class="citation" data-cites="Shapiro2022Principles">Shapiro, MacDonald, &amp; Greenlaw (<a href="#ref-Shapiro2022Principles" role="doc-biblioref">2022</a>, ch.&nbsp;1, 2, 3)</span>; <span class="citation" data-cites="Mankiw2020Principles">Mankiw (<a href="#ref-Mankiw2020Principles" role="doc-biblioref">2024, pt. I</a>)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">How to Measure the Economy</td>
<td style="text-align: left;">We explore methods of measuring economic welfare, a crucial tool for analyzing an economy’s performance and shaping policy decisions. Specifically, we quantify a nation’s economic activity using the Gross Domestic Product (GDP), incorporating consumption, investment, government spending, and net exports. We examine how the GDP reflects changes in living standards over time and enables cross-country comparisons. We introduce the methodology for calculating a consumer price index and the real GDP and we address the possibilities and limitations of these measures. Additionally, we introduce how to measure and interpret trade balances.</td>
<td style="text-align: left;">Lecture notes; <span class="citation" data-cites="Shapiro2022Principles">Shapiro et al. (<a href="#ref-Shapiro2022Principles" role="doc-biblioref">2022</a>, ch.&nbsp;19, 22, 23)</span>; <span class="citation" data-cites="Mankiw2020Principles">Mankiw (<a href="#ref-Mankiw2020Principles" role="doc-biblioref">2024, pt. VIII</a>, ch.&nbsp;32)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">How Markets Work</td>
<td style="text-align: left;">We provide insight into the basic functioning of markets, highlighting the interaction between demand, supply, and prices. We analyze consumer and producer decisions, and their effects on surpluses. With a focus on welfare, we examine the consequences of market interventions such as minimum wage and taxes, while emphasizing the role of competition. Additionally, we distinguish between quantity demanded and demand, as well as quantity supplied and supply. Moreover, we explore the ‘Aggregate Supply and Demand’ (AS-AD) model, a vital tool for understanding how changes in total production and spending influence economic equilibrium, aiding policymakers and economists in shaping effective fiscal and monetary policies.</td>
<td style="text-align: left;">Lecture notes; <span class="citation" data-cites="Shapiro2022Principles">Shapiro et al. (<a href="#ref-Shapiro2022Principles" role="doc-biblioref">2022</a>, ch.&nbsp;3, 5, 6, 7, 24)</span>; <span class="citation" data-cites="Mankiw2020Principles">Mankiw (<a href="#ref-Mankiw2020Principles" role="doc-biblioref">2024, pt. II</a> &amp; ch.&nbsp;7, 8, 34)</span>;</td>
</tr>
<tr class="even">
<td style="text-align: left;">Market Failure</td>
<td style="text-align: left;">We discuss the perfect market in detail and instances of market failure such as externalities of production and consumption. Moreover, we explore strategies to address market failure through political interventions. We also examine the sources of unemployment and methods to combat it.</td>
<td style="text-align: left;">Lecture notes; <span class="citation" data-cites="Shapiro2022Principles">Shapiro et al. (<a href="#ref-Shapiro2022Principles" role="doc-biblioref">2022</a>, ch.&nbsp;8, 9, 12, 13, 14, 21)</span>; <span class="citation" data-cites="Mankiw2020Principles">Mankiw (<a href="#ref-Mankiw2020Principles" role="doc-biblioref">2024</a>, ch.&nbsp;14, 15, 16, 28)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">International Trade</td>
<td style="text-align: left;">We discuss the economic rationale for international trade, focusing on comparative advantage and analyzing supply and demand for exports and imports. We investigate the impact of trade barriers and policies like tariffs on welfare and we introduce the functions of the World Trade Organization (WTO).</td>
<td style="text-align: left;">Lecture notes; <span class="citation" data-cites="Shapiro2022Principles">Shapiro et al. (<a href="#ref-Shapiro2022Principles" role="doc-biblioref">2022</a>, ch.&nbsp;23, 33, 34)</span>; <span class="citation" data-cites="Mankiw2020Principles">Mankiw (<a href="#ref-Mankiw2020Principles" role="doc-biblioref">2024</a>)</span>[3, 9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Monetary International Economics</td>
<td style="text-align: left;">We discuss the foreign exchange market, exploring exchange rates, relative prices, and purchasing power parity, as well as international investments. Furthermore, we examine the roles of central banks and their influence on interest rates and prices.</td>
<td style="text-align: left;">Lecture notes; <span class="citation" data-cites="Shapiro2022Principles">Shapiro et al. (<a href="#ref-Shapiro2022Principles" role="doc-biblioref">2022</a>, ch.&nbsp;28)</span>; <span class="citation" data-cites="Mankiw2020Principles">Mankiw (<a href="#ref-Mankiw2020Principles" role="doc-biblioref">2024</a>)</span>[30, 31</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Economies in the Short Run</td>
<td style="text-align: left;">We explore the determinants of short-run economic dynamics, with a focus on combating recessions. To achieve this, we employ the IS-LM model, which assesses the influence of demand and supply in the goods market. It also examines the interplay between the money market and the interest rate, a tool often adjusted by central banks.</td>
<td style="text-align: left;">Lecture notes; <span class="citation" data-cites="Blanchard2013Blanchard">Blanchard &amp; Johnson (<a href="#ref-Blanchard2013Blanchard" role="doc-biblioref">2013</a>, ch.&nbsp;3, 4, 5)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Behavioral Economics</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Lecture notes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Financial Mathematics</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Lecture notes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Review</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Lecture notes</td>
</tr>
</tbody>
</table>
</section>
<section id="course-policy" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="course-policy">Course Policy</h2>
<ul>
<li>Punctuality is expected. Please arrive on time for class.</li>
<li>Refrain from taking photos or recording during the class.</li>
<li>Feel free to ask questions during the class or reach out via email (stephan.huber@hs-fresenius.de) after the class. Your inquiries are welcome and encouraged.</li>
</ul>
</section>
<section id="syllabus-disclaimer" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="syllabus-disclaimer">Syllabus Disclaimer</h2>
<p>Please note that the syllabus is subject to change. While I will make every effort to inform you in advance of any modifications, there may be instances where adjustments are necessary to enhance the learning experience or address unforeseen circumstances. It is your responsibility to stay updated on any changes, so I recommend regularly checking the course announcements and your email for notifications regarding syllabus updates. Your flexibility and understanding in such situations are greatly appreciated.</p>
</section>
<section id="literature" class="level1 unnumbered">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Literature</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-Blanchard2013Blanchard" class="csl-entry" role="listitem">
Blanchard, O., &amp; Johnson, D. R. (2013). <em>Macroeconomics</em> (6th ed.). Pearson.
</div>
<div id="ref-Mankiw2020Principles" class="csl-entry" role="listitem">
Mankiw, N. G. (2024). <em>Principles of economics</em> (10th ed.). Cengage Learning.
</div>
<div id="ref-Shapiro2022Principles" class="csl-entry" role="listitem">
Shapiro, D., MacDonald, D., &amp; Greenlaw, S. A. (2022). <em>Principles of economics</em> (3rd ed.). OpenStax. Retrieved from <a href="https://openstax.org/details/books/principles-economics-3e">https://openstax.org/details/books/principles-economics-3e</a>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>